<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="fs.human.ecospot.charger.dao.ChargerDAO">
    <select id="selectAllCharger" resultType="fs.human.ecospot.charger.vo.ChargerVO">
        SELECT
        PARKING_ID AS parkingId,
        PARKING_NAME AS parkingName,
        PARKING_LON AS parkingLon,
        PARKING_LAT AS parkingLat,
        PARKING_FEE AS parkingFee,
        PARKING_CODE AS parkingCode,
        PARKING_ADDRESS AS parkingAddress,
        PARKING_ADDRESS_D AS parkingAddressD
        FROM PARKING_TABLE
    </select>

    <resultMap id="ParkingResultMap" type="fs.human.ecospot.charger.dto.PoiParkingMatchDTO">
        <result property="parkingId" column="parking_id" />
        <result property="parkingFee" column="parking_fee" />
    </resultMap>

    <select id="findNearestParkingInfo" resultMap="ParkingResultMap">
        SELECT parking_id, parking_fee FROM (
        SELECT parking_id, parking_fee, (
        6371000 * acos(
        cos(radians(#{lat})) * cos(radians(parking_lat)) *
        cos(radians(parking_lon) - radians(#{lng})) +
        sin(radians(#{lat})) * sin(radians(parking_lat))
        )
        ) AS distance
        FROM TB_PARKING
        WHERE parking_lat BETWEEN #{lat} - 0.001 AND #{lat} + 0.001
        AND parking_lon BETWEEN #{lng} - 0.001 AND #{lng} + 0.001
        )
        WHERE distance &lt;= 100
        ORDER BY distance
        FETCH FIRST 1 ROWS ONLY
    </select>

</mapper>